<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Masjid Shabaab Daawah</title>

<style>
body{
margin:0;
font-family:Arial;
background:#f4f4f4;
}

header{
background:#00695c;
color:white;
text-align:center;
padding:25px;
}

.section{
padding:15px;
}

input, textarea, select{
width:100%;
padding:10px;
margin-bottom:10px;
border-radius:6px;
border:1px solid #ccc;
}

button{
padding:10px;
background:#00695c;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
}

.audio-card{
background:white;
padding:15px;
margin-bottom:15px;
border-radius:8px;
box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
</style>
</head>
<body>

<header>
<h2>MASJID SHABAAB DAAWAH</h2>
<p>Buhongwa â€“ Mwanza</p>
</header>

<div class="section">

<h3>Ongeza Audio</h3>

<input type="text" id="title" placeholder="Jina la Audio">
<textarea id="description" placeholder="Maelezo ya Audio"></textarea>

<select id="category">
<option value="darsa">Darsa</option>
<option value="jumaa">Khutbah ya Ijumaa</option>
<option value="eid">Khutbah ya Eid</option>
<option value="ramadhan">Ramadhani</option>
</select>

<input type="file" id="file">

<button onclick="uploadAudio()">Upload Audio</button>

<hr>

<h3>Tafuta Audio</h3>
<input type="text" id="search" placeholder="Tafuta..." onkeyup="searchAudio()">

<hr>

<h3>Audio Zote</h3>
<div id="audioList"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-storage.js";

const firebaseConfig = {
apiKey: "AIzaSyCRKV93NJ7YX1zP7xAiG340mTXDTIEweaQ",
authDomain: "masjidshabaab.firebaseapp.com",
databaseURL: "https://masjidshabaab-default-rtdb.firebaseio.com/",
projectId: "masjidshabaab",
storageBucket: "masjidshabaab.firebasestorage.app",
messagingSenderId: "590758366670",
appId: "1:590758366670:web:2fe678c410285fab5fef9f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

window.uploadAudio = async function(){

const title = document.getElementById("title").value;
const description = document.getElementById("description").value;
const category = document.getElementById("category").value;
const file = document.getElementById("file").files[0];

if(!title || !file){
alert("Jaza jina na chagua file");
return;
}

const storageRef = sRef(storage, "audios/" + file.name);

await uploadBytes(storageRef, file);

const downloadURL = await getDownloadURL(storageRef);

push(ref(db,"audios"),{
title,
description,
category,
url:downloadURL,
createdAt:Date.now()
});

alert("Audio imeupload kikamilifu!");

document.getElementById("title").value="";
document.getElementById("description").value="";
document.getElementById("file").value="";
};

let allAudios = [];

onValue(ref(db,"audios"), snapshot=>{
allAudios = [];
snapshot.forEach(child=>{
allAudios.push(child.val());
});
displayAudios();
});

function displayAudios(){
const container = document.getElementById("audioList");
container.innerHTML = "";

allAudios.reverse().forEach(audio=>{
container.innerHTML += `
<div class="audio-card">
<h4>${audio.title}</h4>
<p>${audio.description || ""}</p>
<audio controls src="${audio.url}" style="width:100%;"></audio>
<br><br>
<a href="${audio.url}" download>Download</a>
</div>
`;
});
}

window.searchAudio = function(){
const value = document.getElementById("search").value.toLowerCase();
const cards = document.querySelectorAll(".audio-card");

cards.forEach(card=>{
const title = card.querySelector("h4").innerText.toLowerCase();
card.style.display = title.includes(value) ? "block" : "none";
});
};

</script>

</body>
</html>
